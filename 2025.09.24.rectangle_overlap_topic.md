# CHUYÊN ĐỀ: KIỂM TRA GIAO CỦA HAI HÌNH CHỮ NHẬT

## 1. MỤC TIÊU HỌC TẬP

Sau khi hoàn thành chuyên đề này, học sinh sẽ có thể:
- Hiểu khái niệm giao nhau của hai hình chữ nhật trong hệ tọa độ
- Phân tích và tối ưu thuật toán kiểm tra giao nhau
- Viết chương trình hiệu quả với độ phức tạp O(1)
- Áp dụng vào các bài toán collision detection và computer graphics

## 2. CƠ SỞ LÝ THUYẾT

### 2.1. Biểu diễn hình chữ nhật
Một hình chữ nhật được biểu diễn bằng **2 điểm**:
- **l (left-top)**: Điểm trên-trái có tọa độ (x₁, y₁)  
- **r (right-bottom)**: Điểm dưới-phải có tọa độ (x₂, y₂)

**Lưu ý quan trọng**: Trong hệ tọa độ màn hình, trục Y hướng xuống dưới!

### 2.2. Điều kiện để hai hình chữ nhật KHÔNG giao nhau

Hai hình chữ nhật **KHÔNG** giao nhau khi một trong các điều kiện sau đúng:

1. **Tách biệt theo trục X**: Hình chữ nhật này nằm hoàn toàn bên trái/phải hình kia
   - `l1.x > r2.x` (hình 1 nằm bên phải hình 2)
   - `l2.x > r1.x` (hình 2 nằm bên phải hình 1)

2. **Tách biệt theo trục Y**: Hình chữ nhật này nằm hoàn toàn trên/dưới hình kia
   - `r1.y > l2.y` (hình 1 nằm dưới hình 2)
   - `r2.y > l1.y` (hình 2 nằm dưới hình 1)

### 2.3. Minh họa trực quan

![Rectangle Overlap](https://media.geeksforgeeks.org/wp-content/cdn-uploads/rectanglesOverlap.png)

**Sơ đồ các trường hợp:**
```
Trường hợp 1: GIAO NHAU          Trường hợp 2: KHÔNG GIAO NHAU
┌─────┐                          ┌─────┐
│  R1 │ ┌─────┐                  │  R1 │    ┌─────┐
│     └─┤ R2  │                  │     │    │  R2 │
└───────┤     │                  └─────┘    │     │
        └─────┘                             └─────┘

Trường hợp 3: R1 BÊN TRÁI R2     Trường hợp 4: R1 TRÊN R2
┌─────┐   ┌─────┐                ┌─────┐
│  R1 │   │  R2 │                │  R1 │
│     │   │     │                └─────┘
└─────┘   └─────┘                ┌─────┐
                                 │  R2 │
                                 └─────┘
```

## 3. CÁC VÍ DỤ MINH HỌA

### Ví dụ 1: Hai hình chữ nhật giao nhau
**Input:** 
- Rectangle 1: l1 = (0, 10), r1 = (10, 0)
- Rectangle 2: l2 = (5, 5), r2 = (15, 0)

**Kiểm tra:**
- l1.x = 0 ≤ r2.x = 15 ✓ (không tách biệt theo X)
- l2.x = 5 ≤ r1.x = 10 ✓ (không tách biệt theo X)
- r1.y = 0 ≤ l2.y = 5 ✓ (không tách biệt theo Y)
- r2.y = 0 ≤ l1.y = 10 ✓ (không tách biệt theo Y)

**Output:** Rectangles Overlap

### Ví dụ 2: Hai hình chữ nhật không giao nhau  
**Input:**
- Rectangle 1: l1 = (0, 10), r1 = (10, 0)
- Rectangle 2: l2 = (-10, 5), r2 = (-1, 0)

**Kiểm tra:**
- l1.x = 0 > r2.x = -1 ✗ (tách biệt theo X)

**Output:** Rectangles Don't Overlap

## 4. HIỆN THỰC THUẬT TOÁN

### 4.1. Thuật toán tổng quát
```
INPUT: l1, r1, l2, r2 (4 điểm định nghĩa 2 hình chữ nhật)
BEGIN
    // Kiểm tra tách biệt theo trục X
    IF (l1.x > r2.x) OR (l2.x > r1.x) THEN
        RETURN false
    
    // Kiểm tra tách biệt theo trục Y  
    IF (r1.y > l2.y) OR (r2.y > l1.y) THEN
        RETURN false
    
    RETURN true
END
```

### 4.2. Code C++
```cpp
#include <bits/stdc++.h>
using namespace std;

// Cấu trúc điểm trong hệ tọa độ
struct Point {
    int x, y;
    
    Point(int x = 0, int y = 0) : x(x), y(y) {}
    
    void print() const {
        cout << "(" << x << ", " << y << ")";
    }
};

// Hàm kiểm tra giao nhau của hai hình chữ nhật
bool doOverlap(Point l1, Point r1, Point l2, Point r2) {
    // Kiểm tra tách biệt theo trục X
    if (l1.x > r2.x || l2.x > r1.x)
        return false;
    
    // Kiểm tra tách biệt theo trục Y
    if (r1.y > l2.y || r2.y > l1.y)
        return false;
    
    return true;
}

// Hàm hiển thị thông tin hình chữ nhật
void printRectangle(Point l, Point r, string name) {
    cout << name << ": Top-Left = ";
    l.print();
    cout << ", Bottom-Right = ";
    r.print();
    cout << endl;
}

// Chương trình chính
int main() {
    cout << "=== KIỂM TRA GIAO NHAU CỦA HAI HÌNH CHỮ NHẬT ===\n\n";
    
    // Ví dụ 1: Giao nhau
    cout << "VÍ DỤ 1: Hai hình chữ nhật giao nhau\n";
    Point l1(0, 10), r1(10, 0);
    Point l2(5, 5), r2(15, 0);
    
    printRectangle(l1, r1, "Rectangle 1");
    printRectangle(l2, r2, "Rectangle 2");
    
    if (doOverlap(l1, r1, l2, r2))
        cout << "Kết quả: Rectangles Overlap\n\n";
    else
        cout << "Kết quả: Rectangles Don't Overlap\n\n";
    
    // Ví dụ 2: Không giao nhau
    cout << "VÍ DỤ 2: Hai hình chữ nhật không giao nhau\n";
    Point l3(0, 10), r3(10, 0);
    Point l4(-10, 5), r4(-1, 0);
    
    printRectangle(l3, r3, "Rectangle 1");
    printRectangle(l4, r4, "Rectangle 2");
    
    if (doOverlap(l3, r3, l4, r4))
        cout << "Kết quả: Rectangles Overlap\n\n";
    else
        cout << "Kết quả: Rectangles Don't Overlap\n\n";
    
    // Nhập từ người dùng
    cout << "NHẬP THÔNG TIN TỪ NGƯỜI DÙNG:\n";
    cout << "Nhập tọa độ hình chữ nhật 1:\n";
    cout << "Top-Left (x1 y1): ";
    int x1, y1, x2, y2;
    cin >> x1 >> y1 >> x2 >> y2;
    cout << "Bottom-Right (x2 y2): " << x2 << " " << y2 << "\n";
    
    cout << "Nhập tọa độ hình chữ nhật 2:\n";
    cout << "Top-Left (x3 y3): ";
    int x3, y3, x4, y4;
    cin >> x3 >> y3 >> x4 >> y4;
    cout << "Bottom-Right (x4 y4): " << x4 << " " << y4 << "\n";
    
    Point userL1(x1, y1), userR1(x2, y2);
    Point userL2(x3, y3), userR2(x4, y4);
    
    if (doOverlap(userL1, userR1, userL2, userR2))
        cout << "\nKết quả: Hai hình chữ nhật GIAO NHAU\n";
    else
        cout << "\nKết quả: Hai hình chữ nhật KHÔNG GIAO NHAU\n";
    
    return 0;
}
```

### 4.3. Code Python
```python
class Point:
    """Lớp biểu diễn một điểm trong hệ tọa độ 2D"""
    
    def __init__(self, x=0, y=0):
        self.x = x
        self.y = y
    
    def __str__(self):
        return f"({self.x}, {self.y})"

def do_overlap(l1, r1, l2, r2):
    """
    Kiểm tra hai hình chữ nhật có giao nhau hay không
    
    Args:
        l1, r1: Top-left và bottom-right của hình chữ nhật 1
        l2, r2: Top-left và bottom-right của hình chữ nhật 2
    
    Returns:
        True nếu giao nhau, False nếu không
    """
    # Kiểm tra tách biệt theo trục X
    if l1.x > r2.x or l2.x > r1.x:
        return False
    
    # Kiểm tra tách biệt theo trục Y
    if r1.y > l2.y or r2.y > l1.y:
        return False
    
    return True

def print_rectangle(l, r, name):
    """Hiển thị thông tin hình chữ nhật"""
    print(f"{name}: Top-Left = {l}, Bottom-Right = {r}")

def analyze_overlap(l1, r1, l2, r2):
    """Phân tích chi tiết quá trình kiểm tra giao nhau"""
    print("\n--- PHÂN TÍCH CHI TIẾT ---")
    print(f"Kiểm tra tách biệt theo trục X:")
    print(f"  l1.x = {l1.x} > r2.x = {r2.x}? {l1.x > r2.x}")
    print(f"  l2.x = {l2.x} > r1.x = {r1.x}? {l2.x > r1.x}")
    
    print(f"Kiểm tra tách biệt theo trục Y:")
    print(f"  r1.y = {r1.y} > l2.y = {l2.y}? {r1.y > l2.y}")  
    print(f"  r2.y = {r2.y} > l1.y = {l1.y}? {r2.y > l1.y}")

# Chương trình chính
def main():
    print("=== KIỂM TRA GIAO NHAU CỦA HAI HÌNH CHỮ NHẬT ===\n")
    
    # Ví dụ 1: Giao nhau
    print("VÍ DỤ 1: Hai hình chữ nhật giao nhau")
    l1 = Point(0, 10)
    r1 = Point(10, 0)
    l2 = Point(5, 5)
    r2 = Point(15, 0)
    
    print_rectangle(l1, r1, "Rectangle 1")
    print_rectangle(l2, r2, "Rectangle 2")
    
    result1 = do_overlap(l1, r1, l2, r2)
    print(f"Kết quả: {'Rectangles Overlap' if result1 else 'Rectangles Don\\'t Overlap'}")
    analyze_overlap(l1, r1, l2, r2)
    
    print("\n" + "="*50 + "\n")
    
    # Ví dụ 2: Không giao nhau
    print("VÍ DỤ 2: Hai hình chữ nhật không giao nhau")
    l3 = Point(0, 10)
    r3 = Point(10, 0)
    l4 = Point(-10, 5)
    r4 = Point(-1, 0)
    
    print_rectangle(l3, r3, "Rectangle 1")
    print_rectangle(l4, r4, "Rectangle 2")
    
    result2 = do_overlap(l3, r3, l4, r4)
    print(f"Kết quả: {'Rectangles Overlap' if result2 else 'Rectangles Don\\'t Overlap'}")
    analyze_overlap(l3, r3, l4, r4)
    
    print("\n" + "="*50 + "\n")
    
    # Nhập từ người dùng
    print("NHẬP THÔNG TIN TỪ NGƯỜI DÙNG:")
    try:
        print("Nhập tọa độ hình chữ nhật 1:")
        x1, y1 = map(int, input("Top-Left (x1 y1): ").split())
        x2, y2 = map(int, input("Bottom-Right (x2 y2): ").split())
        
        print("Nhập tọa độ hình chữ nhật 2:")
        x3, y3 = map(int, input("Top-Left (x3 y3): ").split())
        x4, y4 = map(int, input("Bottom-Right (x4 y4): ").split())
        
        user_l1 = Point(x1, y1)
        user_r1 = Point(x2, y2)
        user_l2 = Point(x3, y3)
        user_r2 = Point(x4, y4)
        
        user_result = do_overlap(user_l1, user_r1, user_l2, user_r2)
        print(f"\nKết quả: Hai hình chữ nhật {'GIAO NHAU' if user_result else 'KHÔNG GIAO NHAU'}")
        analyze_overlap(user_l1, user_r1, user_l2, user_r2)
        
    except ValueError:
        print("Lỗi: Vui lòng nhập số nguyên hợp lệ!")

if __name__ == "__main__":
    main()
```

## 5. PHÂN TÍCH ĐỘ PHỨC TẠP

- **Độ phức tạp thời gian:** O(1) - Chỉ cần 4 phép so sánh
- **Độ phức tạp không gian:** O(1) - Không sử dụng bộ nhớ phụ
- **Tính ổn định:** Thuật toán luôn chính xác với mọi input hợp lệ

## 6. CÁC PHƯƠNG PHÁP KHÁC

### 6.1. Phương pháp Intersection Area
```cpp
// Tính diện tích giao nhau (nếu có)
int intersectionArea(Point l1, Point r1, Point l2, Point r2) {
    if (!doOverlap(l1, r1, l2, r2))
        return 0;
    
    int left = max(l1.x, l2.x);
    int right = min(r1.x, r2.x);
    int top = min(l1.y, l2.y);
    int bottom = max(r1.y, r2.y);
    
    return (right - left) * (top - bottom);
}
```

### 6.2. Phương pháp Point-in-Rectangle
```cpp
// Cách tiếp cận khác: kiểm tra từng điểm
bool alternativeOverlap(Point l1, Point r1, Point l2, Point r2) {
    // Kiểm tra 4 góc của rectangle 1 có nằm trong rectangle 2 không
    // Và ngược lại
    
    // Phức tạp hơn và không hiệu quả bằng phương pháp chính
    // Chỉ dùng cho mục đích học thuật
}
```

## 7. BÀI TẬP THỰC HÀNH

### Bài tập 1: Cơ bản
Viết chương trình đếm số cặp hình chữ nhật giao nhau trong một danh sách n hình chữ nhật.

### Bài tập 2: Mở rộng
Tính diện tích vùng giao nhau của hai hình chữ nhật (nếu có).

### Bài tập 3: Tối ưu hóa
Trong n hình chữ nhật, tìm hình chữ nhật giao với nhiều hình khác nhất.

### Bài tập 4: Ứng dụng
Simulation game: Kiểm tra va chạm giữa các đối tượng hình chữ nhật.

## 8. MỞ RỘNG VÀ ỨNG DỤNG

### 8.1. Collision Detection trong Game
```cpp
class GameObject {
    Point topLeft, bottomRight;
    bool isColliding(const GameObject& other) const {
        return doOverlap(topLeft, bottomRight, 
                        other.topLeft, other.bottomRight);
    }
};
```

### 8.2. Ứng dụng trong UI/UX
```cpp
// Kiểm tra overlap giữa các UI elements
bool isUIOverlap(Widget w1, Widget w2) {
    return doOverlap(w1.getBounds().topLeft, w1.getBounds().bottomRight,
                    w2.getBounds().topLeft, w2.getBounds().bottomRight);
}
```

### 8.3. Computer Graphics
- **Clipping algorithms**: Xác định vùng hiển thị
- **2D rendering**: Optimized drawing của overlapping objects  
- **Spatial partitioning**: QuadTree, R-Tree optimization

### 8.4. Computational Geometry
```cpp
// Mở rộng lên 3D - Box Overlap
struct Box3D {
    Point3D min, max;
};

bool doBoxesOverlap(Box3D b1, Box3D b2) {
    return (b1.min.x <= b2.max.x && b2.min.x <= b1.max.x) &&
           (b1.min.y <= b2.max.y && b2.min.y <= b1.max.y) &&
           (b1.min.z <= b2.max.z && b2.min.z <= b1.max.z);
}
```

## 9. BẢNG THAM KHẢO NHANH

| Điều kiện | Mô tả | Công thức |
|-----------|--------|-----------|
| Tách biệt X | R1 bên trái R2 | l1.x > r2.x |
| Tách biệt X | R2 bên trái R1 | l2.x > r1.x |
| Tách biệt Y | R1 trên R2 | r1.y > l2.y |
| Tách biệt Y | R2 trên R1 | r2.y > l1.y |
| **Giao nhau** | **Không tách biệt** | **Tất cả điều kiện trên đều false** |

## 10. KẾT LUẬN

Bài toán kiểm tra giao nhau của hai hình chữ nhật là một ví dụ xuất sắc về:

- **Geometric algorithms**: Nền tảng cho computational geometry
- **Optimization thinking**: Từ O(n) xuống O(1) bằng cách thay đổi cách tiếp cận
- **Practical applications**: Rất nhiều ứng dụng trong thực tế
- **Clean code principles**: Thuật toán đơn giản, dễ hiểu và maintain

Đây là kiến thức cốt lõi trong computer graphics, game development, và UI programming. Việc nắm vững thuật toán này giúp giải quyết nhiều bài toán phức tạp khác liên quan đến geometric intersection.